
import subprocess, sys, glob, os

def test_smoke_creates_outputs(tmp_path):
    scene = tmp_path/"scene.yaml"
    scene.write_text("""
scene:
  source: {x0: 0.8, y0: 1.0, frequency_hz: 6e9, amplitude: 1.0}
  objects:
    - {x: 1.2, y: 1.3, r: 0.08, material: metal}
""", encoding="utf-8")

    # запускаем твой solver
    subprocess.check_call([sys.executable, "solver_simple_torch.py", str(scene), "--nx", "120", "--ny", "80"])

    # ищем последний out_dir
    dirs = sorted(glob.glob("simple_results/*"))
    assert len(dirs) > 0
    out_dir = dirs[-1]

    for f in ["field_pred.png", "field_true.png", "field_err.png", "metrics.txt"]:
        assert os.path.exists(os.path.join(out_dir, f))
